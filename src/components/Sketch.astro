---
const imageFiles = [
  "Abby-Shuster-2021.png",
  "Alegria-Ponce-2020.png",
  "Alex-Rojo-2020.png",
  "Amy-Middleton-2024.png",
  "Chayse-Walker-2024.gif",
  "Elizabeth-Harris-2020.png",
  "Gu-Jianan-2019.png",
  "Hailey-Walsh-2020.png",
  "Ivy-Kurniawan-2023.png",
  "Jade-VandenBrink-2023.png",
  "Jingyang-Shi-2019.png",
  "Kriti-Gupta-2021.png",
  "Lingfei-Cao-2021.png",
  "Mengfei-Yun-2018.png",
  "Mengting-Zhu-2023.png",
  "Mengting-Zhu-2023b.png",
  "Nedda-Alsaikhan-2023.jpg",
  "Pia-Contreras-2023.jpg",
  "Polly-Zhang-2020.png",
  "Ruqui-Fang-2022.png",
  "Shu-Ge-Wang-2019.png",
  "Stella-Kuang-2023.png",
  "Sunho-Im-2019.png",
  "Tzu-Wei-2021.png",
  "Tzu-Wei-2021b.png",
  "Woojin-Lee-(Faculty)-2020-Class-Show.png",
  "Woraphan-Jampachaisri-2021.jpg",
  "Yan-Leng-2024.png",
  "Yanan-Wang-2023.jpg",
  "Yaru-Zhang-2023.png",
  "Yeonji-Choi-2018.png",
  "Yiran-Xu-2023.png",
  "Yiwen-Chen-2021.png",
  "Yu-Yijun-2022.png",
  "Yurou-Xia-2018.png",
  "Zhan-Yining-2019.png",
  "Zhang-Han-2024.png",
  "Zhihan-Qian-2021.png",
];

// Function to extract student name from filename
function extractStudentName(filename) {
  const nameWithoutExt = filename.replace(/\.[^/.]+$/, "");

  if (nameWithoutExt === "Woojin-Lee-(Faculty)-2020-Class-Show") {
    return "Woojin-Lee (Faculty) 2020 Class Show";
  }

  const parts = nameWithoutExt.split("-");
  const nameParts = parts.filter((part) => {
    if (/^\d{4}$/.test(part)) return false;
    if (/^\d{4}[a-zA-Z]$/.test(part)) return false;
    if (["(Faculty)", "Class", "Show"].includes(part)) return false;
    return true;
  });

  if (nameParts.length >= 3) {
    return `${nameParts[0]} ${nameParts[nameParts.length - 1]}`;
  }

  if (nameParts.length === 2) {
    return `${nameParts[0]} ${nameParts[1]}`;
  }

  return nameParts.join(" ");
}

const imageData = imageFiles.map((file) => ({
  url: `/assets/img/${file}`,
  name: extractStudentName(file),
}));

const imageUrls = imageData.map((data) => data.url);
const imageNames = imageData.map((data) => data.name);
---

<div class="sketch-wrapper ridge-border cutoff">
  <img id="image-element" class="image fade" src="" alt="" />
</div>
<div id="student-name" class="student-name fade cutoff"></div>

<script define:vars={{ imageUrls, imageNames }}>
  /* eslint-disable no-undef */
  const images = imageUrls;
  const names = imageNames;
  /* eslint-enable no-undef */

  function shuffleArray(array) {
    const shuffled = [...array];
    for (let i = shuffled.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    return shuffled;
  }

  let allIndices = Array.from({ length: images.length }, (_, i) => i);
  let shuffledIndices = shuffleArray(allIndices);
  let currentIndex = 0;

  function changeContent() {
    const imgElement = document.getElementById("image-element");
    const nameElement = document.getElementById("student-name");

    if (!imgElement || !nameElement) return;

    imgElement.classList.add("fade-out");
    nameElement.classList.add("fade-out");

    setTimeout(() => {
      const imageIndex = shuffledIndices[currentIndex];

      imgElement.src = images[imageIndex];
      imgElement.alt = names[imageIndex];
      nameElement.textContent = names[imageIndex];

      currentIndex++;
      if (currentIndex >= shuffledIndices.length) {
        shuffledIndices = shuffleArray(allIndices);
        currentIndex = 0;
      }

      imgElement.classList.remove("fade-out");
      nameElement.classList.remove("fade-out");
    }, 1000);
  }

  // Load first image immediately
  window.addEventListener("DOMContentLoaded", changeContent);

  // Change every 4 seconds
  setInterval(changeContent, 8000);
</script>
